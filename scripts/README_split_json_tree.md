# Скрипт разделения JSON на дерево файлов

Этот скрипт разделяет большой JSON файл с иерархической структурой на множество маленьких файлов, сохраняя отношения в виде дерева на файловой системе.

## Структура данных

Скрипт работает с иерархической структурой:
```
Portrait -> Section -> Subsection -> QuestionGroup -> Question -> Answer
```

## Быстрый старт

### 1. Разделение JSON файла
```bash
# Переходим в папку со скриптами
cd scripts

# Разделяем JSON файл на дерево файлов
python split_json_tree.py example_checklist.json output_folder --create-rebuild-script
```

### 2. Восстановление JSON файла
```bash
# Восстанавливаем исходный JSON из дерева файлов
cd output_folder
python rebuild_json.py . restored_file.json
```

### 3. Проверка результата
```bash
# Сравниваем исходный и восстановленный файлы
diff example_checklist.json output_folder/restored_file.json
```

## Использование

### Основная команда
```bash
python scripts/split_json_tree.py input.json output_directory
```

### С созданием скрипта восстановления
```bash
python scripts/split_json_tree.py input.json output_directory --create-rebuild-script
```

### Примеры для разных случаев

#### Для больших чек-листов
```bash
python split_json_tree.py huge_checklist.json checklist_modules --create-rebuild-script
```

#### Для разработки
- Редактируйте отдельные файлы в дереве
- Используйте Git для отслеживания изменений
- Собирайте финальный JSON для продакшена

#### Для тестирования
- Создавайте тестовые наборы из отдельных модулей
- Легко добавляйте/удаляйте части для тестов

## Структура выходных файлов

После разделения создается следующая структура:

```
output_directory/
├── index.json                          # Индексный файл с метаданными
├── rebuild_json.py                     # Скрипт восстановления
└── portrait_id/                        # Папка портрета
    ├── portrait.json                   # Основные данные портрета
    └── section_id/                     # Папка секции
        ├── section.json                # Основные данные секции
        └── subsection_id/              # Папка подсекции
            ├── subsection.json         # Основные данные подсекции
            └── question_group_id/      # Папка группы вопросов
                ├── group.json          # Основные данные группы
                └── question_id/        # Папка вопроса
                    ├── question.json   # Основные данные вопроса
                    ├── answer1_id.json # Файл ответа 1
                    ├── answer2_id.json # Файл ответа 2
                    └── ...             # Другие ответы
```

### Пример реальной структуры
```
test_output/
├── index.json
├── rebuild_json.py
└── physical-portrait/
    ├── portrait.json
    ├── appearance/                     # Секция "Внешность"
    │   ├── section.json
    │   └── physique/                   # Подсекция "Телосложение"
    │       ├── subsection.json
    │       ├── height-proportions/     # Группа "Рост и пропорции"
    │       │   ├── group.json
    │       │   ├── height/             # Вопрос "Какой у меня рост?"
    │       │   │   ├── question.json
    │       │   │   ├── short.json      # Ответ "низкий"
    │       │   │   ├── average.json    # Ответ "средний"
    │       │   │   └── tall.json       # Ответ "высокий"
    │       │   └── build/              # Вопрос "Телосложение"
    │       │       ├── question.json
    │       │       ├── slim.json
    │       │       └── athletic.json
    │       └── facial-features/        # Группа "Черты лица"
    │           └── ...
    └── behavior/                       # Секция "Поведение"
        └── ...
```

## Формат файлов

### Файлы с данными
Каждый файл содержит:
- `id` - идентификатор элемента
- `title` - название элемента (только если есть в исходных данных)
- `type` - тип элемента (portrait, section, subsection, question_group, question, answer)
- `children` - массив ссылок на дочерние файлы (если есть)
- Специфичные поля для каждого типа

### Индексный файл
```json
{
  "root": "portrait_id/portrait.json",
  "created_at": "timestamp",
  "source_file": "input.json",
  "structure": "portrait -> section -> subsection -> question_group -> question -> answer"
}
```

## Преимущества

1. **Модульность**: Каждый элемент в отдельном файле
2. **Навигация**: Легко найти нужный элемент по структуре папок
3. **Версионирование**: Можно отслеживать изменения отдельных элементов
4. **Производительность**: Загружать только нужные части данных
5. **Совместная работа**: Разные люди могут работать с разными частями
6. **Git-friendly**: Каждое изменение в отдельном файле
7. **Масштабируемость**: Подходит для очень больших JSON файлов

## Особенности

1. **Безопасные имена файлов**: Все недопустимые символы заменяются на подчеркивания
2. **Сохранение связей**: Каждый файл содержит ссылки на дочерние элементы
3. **Восстановление**: Автоматически создается скрипт для восстановления исходного JSON
4. **Кодировка**: Все файлы сохраняются в UTF-8 с поддержкой русских символов
5. **Чистота данных**: Служебные поля не попадают в восстановленный JSON

## Ограничения

- Работает только с JSON файлами указанной структуры
- Имена файлов ограничены 50 символами
- Требует Python 3.6+

## Файлы проекта

- `split_json_tree.py` - основной скрипт разделения
- `README_split_json_tree.md` - данная документация
