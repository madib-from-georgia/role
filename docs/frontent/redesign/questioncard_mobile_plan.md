# План улучшений `QuestionCard` (mobile‑first)

## Цель
- **Удобство на мобильных устройствах**: крупные зоны касания, читабельность, минимум отвлечений.
- **Быстрые действия**: «Сохранить и далее», жесты, шорткаты.
- **Надёжное сохранение**: авто/ручное, дебаунс, статусы.
- **Доступность**: контраст, фокус, aria, `prefers-reduced-motion`.

## Область работ
- **Компоненты**: `frontend/src/components/checklists/QuestionCard.tsx`, `QuestionFlow.tsx`, `QuestionNavigation.tsx`, `NavigationSidebar.tsx`.
- **Стили**: `frontend/src/styles_v2/question-flow.css`, `frontend/src/styles_v2/variables.css`.
- **Поведение**: обработка жестов, шорткатов, дебаунс автосохранения, статусы.

## Итоговые артефакты
- **Обновлённый `QuestionCard`**: мобильная иерархия, «чип‑опции», сворачиваемые подсекции, нижний action‑bar.
- **Навигация**: свайпы/шорткаты, явные подсказки.
- **A11y**: роли/aria, фокус, локализация дат.
- **Тесты/доки**: unit/E2E сценарии, краткое README.

## Десктопный вид: дополнительные улучшения

- **Композиция и плотность**
  - Двухколоночная сетка для вариантов ответов при ширине ≥ 1024px; автоматический переход в одну колонку на меньших экранах.
  - По умолчанию раскрытая подсказка на десктопе (если она есть); контекст (хлебные крошки) — в одну строку, полная версия.
  - Комфортная ширина `question-card`: 48–56rem (настраиваемо через токен), умеренная плотность вертикальных отступов.

- **Навигация и макет**
  - Левый сайдбар навигации постоянно видим (не оверлей), с возможностью изменения ширины (≈ 18–24rem) и запоминанием состояния.
  - Липкий (sticky) хедер с прогрессом и управляющими элементами; липкий футер навигации всегда доступен.
  - На очень широких экранах (≥ 1280px) опционально трёхпанельный макет: слева — навигация, центр — вопрос, справа — асайд с «Источник/Заметки/Подсказка».

- **Взаимодействия и продуктивность**
  - Богатые состояния `hover/focus` у опций и действий; тултипы с подсказками шорткатов.
  - «Очистить выбор»/«Сбросить» доступен inline рядом с опциями; для multiple — чек‑чипы в сетке, для single — выбор из кликабельных карточек.
  - Быстрый переход: клавиши 1–9 — выбор опций, Cmd/Ctrl+Enter — «Сохранить и далее», Cmd/Ctrl+S — «Сохранить», Home/End — к началу/концу.

- **Доступность и производительность**
  - Видимая фокус‑обводка, корректный порядок табуляции, роли/ARIA для групп опций, `aria-live` для статусов.
  - Мемоизация рендеров и предотвращение лишних перерисовок на длинных списках опций.

## Фазы и задачи

- **Фаза 0 — Подготовка (0.5 дн)**
  - Аудит токенов (`variables.css`), добавление `safe-area` и мобильных размеров.
  - Подтверждение мобильной иерархии: вопрос → ответ → действия → доп. поля.
  - Критерии: утверждённый UX‑скетч, список токенов.

- **Фаза 1 — Быстрые победы (1 дн)**
  - Сворачиваемые блоки: «Подсказка», «Источник», «Заметки» (по умолчанию закрыты на мобиле).
  - Опции как полноширинные «чип‑карты» с явной выбранностью; одна колонка на мобиле.
  - Кнопки «Сбросить» (single) / «Очистить выбор» (multiple).
  - Текстовый ответ: авто‑рост и счётчик символов.
  - Нижний закреплённый action‑bar: «Сохранить и далее» (основная) и «Сохранить», с учётом `safe-area`.
  - Критерии: hit‑area ≥ 44px, карточка не «прыгает», действия доступны без скролла.

- **Фаза 2 — Навигация и сохранение (1–1.5 дн)**
  - Свайпы влево/вправо в области вопроса для переходов (без конфликта со скроллом).
  - Шорткаты: Cmd/Ctrl+Enter — «Сохранить и далее», Cmd/Ctrl+S — «Сохранить», 1–9 — опции.
  - Дебаунс автосохранения опций, отмена устаревших запросов, индикатор несохранённых изменений.
  - Обработка ошибок сохранения с ретраем.
  - Критерии: жесты работают на iOS/Android, без дублей запросов, понятные статусы.

- **Фаза 3 — Доступность (0.5–1 дн)**
  - Роли/aria: `radiogroup/group`, `aria-live` для статуса, `aria-describedby` у полей.
  - Видимая focus‑обводка, корректная табуляция, локализация дат/форматов.
  - Критерии: Lighthouse Accessibility ≥ 95, корректное чтение VoiceOver/TalkBack.

- **Фаза 4 — Полировка и перф (0.5 дн)**
  - Мемоизация списков опций, уменьшение перерисовок.
  - Анимации с уважением к `prefers-reduced-motion`, плавные состояния.
  - Визуальные правки карточки на малых экранах.
  - Критерии: плавность на средних устройствах, без лагов.

- **Фаза 5 — Тестирование и релиз (0.5–1 дн)**
  - Unit‑тесты: дебаунс, сброс выбора, статусы.
  - E2E: заполнение/навигация/ошибка‑ретрай на iOS Safari и Android Chrome.
  - Визуальные снэпшоты ключевых состояний.
  - Релиз по фича‑флагу, откатный путь, обновлённый README.
  - Критерии: зелёные тесты, фича‑флаг включается без регрессий.

## Риски и меры
- **Конфликт свайпов со скроллом**: ограничение области жестов, порог свайпа, опция выключить.
- **Клавиатура перекрывает action‑bar**: авто‑скролл к активному полю, отступы `safe-area`.
- **Шум запросов**: дебаунс, отмена устаревших мутаций, оффлайн‑индикатор и ретрай.

## Оценка сроков
- **Итого**: 3–4 рабочих дня.
- **Порядок релиза**: Фаза 1 — отдельным инкрементом; затем 2 → 3 → 4 → 5.

## Acceptance Criteria
- **Мобайл‑карточка**: читаемый заголовок, свёрнутые доп. секции, крупные опции‑чипы, нижний action‑bar.
- **Сохранение**: авто/ручное, дебаунс, статусы; ошибки с ретраем.
- **Навигация**: свайпы и шорткаты; пользовательские подсказки.
- **A11y**: ≥ 95, фокус виден, читабельность экранным диктором.
- **Тесты**: ключевые сценарии зелёные на iOS/Android/desktop.


