# Детальный план покрытия фронтенда тестами

На основе анализа структуры проекта составлен комплексный план тестирования. Уже настроена инфраструктура: **Vitest**, **React Testing Library**, **jest-dom**, **jsdom**, и **Coverage**.

## 1. Инструменты тестирования

### Уже настроены:
- **Vitest** (0.34.6) - основной тестовый фреймворк
- **React Testing Library** (13.4.0) - тестирование компонентов
- **@testing-library/jest-dom** - DOM матчеры
- **@testing-library/user-event** - симуляция пользовательских действий
- **jsdom** - DOM окружение для тестов
- **@vitest/coverage-v8** - покрытие кода

### Дополнительно потребуется:
- **Mock Service Worker (MSW)** - для мокирования API
- **@testing-library/react-hooks** - для тестирования хуков
- **@faker-js/faker** - для генерации тестовых данных

## 2. Структура тестирования

### 2.1 Unit тесты компонентов

**Приоритет: Высокий**

#### Auth компоненты (частично готово):
- ✅ `AuthContext` - полностью покрыт
- ✅ `LoginForm` - полностью покрыт  
- ✅ `RegisterForm` - полностью покрыт
- ✅ `ProtectedRoute` - полностью покрыт
- ✅ `AuthGuard` - полностью покрыт
- ❌ `AuthModal` - требует тестирования

#### Checklist компоненты:
- `ChecklistGroup` - тестирование группировки и отображения
- `ChecklistsOverview` - общий обзор прогресса
- `ChecklistSwitcher` - переключение между чек-листами
- `ExportDialog` - диалог экспорта в разных форматах
- `NavigationSidebar` - навигация по разделам
- `OverallProgress` - общий прогресс выполнения
- `ProgressBar` - компонент прогресс-бара
- `QuestionCard` - карточка отдельного вопроса
- `QuestionFlow` - поток вопросов
- `QuestionNavigation` - навигация по вопросам
- `RecommendedNextStep` - рекомендации следующих шагов

#### Основные компоненты:
- `Header` - заголовок с навигацией
- `ChangePasswordForm` - форма смены пароля
- `CharacterAnalysis` - анализ персонажей

### 2.2 Integration тесты страниц

**Приоритет: Высокий**

#### Страницы проекта:
- `ProjectList` - список проектов с пагинацией
- `ProjectDetail` - детальная страница проекта
- `CreateProject` - создание нового проекта

#### Страницы чек-листов:
- `CharacterChecklistsV2` - список чек-листов персонажа
- `CharacterChecklistDetailV2` - детали чек-листа

#### Профиль:
- `Profile` - страница профиля пользователя

### 2.3 Service/API тесты

**Приоритет: Средний**

#### API сервисы:
- `auth.ts` - все методы аутентификации
- `api/index.ts` - базовые API методы

#### Утилиты:
- `downloadFile.ts` - загрузка файлов
- `errorHandling.ts` - обработка ошибок

### 2.4 Hook тесты

**Приоритет: Средний**

#### Кастомные хуки:
- Хуки из `AuthContext`
- Хуки для работы с React Query
- Хуки для управления состоянием форм

## 3. Типы тестов по слоям

### 3.1 Компонентные тесты (70%)
- **Рендеринг** - корректное отображение
- **Пропсы** - правильная обработка входных данных
- **События** - клики, формы, навигация
- **Состояние** - изменения локального состояния
- **Условный рендеринг** - разные состояния UI

### 3.2 Интеграционные тесты (20%)
- **API взаимодействие** - запросы к бэкенду
- **Роутинг** - навигация между страницами
- **Контекст** - передача данных через провайдеры
- **Сложные пользовательские сценарии**

### 3.3 E2E тесты (10%)
- **Критические пути** - регистрация, логин, создание проекта
- **Полные флоу** - работа с чек-листами от начала до экспорта

## 4. Конфигурация тестового окружения

### 4.1 Vitest конфигурация
```typescript
// vitest.config.ts
- Настройка jsdom окружения
- Конфигурация coverage
- Глобальные матчеры jest-dom
- Алиасы путей
- Mock конфигурация
```

### 4.2 MSW настройка
- Мокирование всех API эндпоинтов
- Разные сценарии ответов (успех, ошибки)
- Тестовые данные для разных состояний

### 4.3 Test utilities
- Общие моки и фикстуры
- Обертки для тестирования (TestWrapper)
- Хелперы для работы с формами

## 5. Покрытие кода

### Целевые метрики:
- **Общее покрытие**: 85%+
- **Компоненты**: 90%+
- **Сервисы**: 80%+
- **Утилиты**: 95%+

### Исключения из покрытия:
- Конфигурационные файлы
- Типы TypeScript
- Стили CSS

## 6. Приоритизация внедрения

### Фаза 1 (Критическая):
1. Доустановка недостающих инструментов
2. Настройка MSW для API мокирования
3. Тестирование всех checklist компонентов
4. Тестирование страниц проектов

### Фаза 2 (Важная):
1. Integration тесты основных флоу
2. Тестирование утилит и сервисов
3. Настройка автоматических отчетов покрытия

### Фаза 3 (Дополнительная):
1. E2E тесты критических путей
2. Performance тесты компонентов
3. Accessibility тесты

## 7. CI/CD интеграция

- **Pre-commit хуки** - запуск тестов перед коммитом
- **GitHub Actions** - автоматический запуск на PR
- **Coverage отчеты** - интеграция с платформами мониторинга
- **Fail-fast** - остановка сборки при падении тестов

Этот план обеспечит комплексное покрытие всех критических частей фронтенда с акцентом на надежность и поддерживаемость тестов.
